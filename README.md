About
=====

This document describes the AlchemyCodingTest project, its layout as well as how to build and deploy it.
This project contains both the HTML5 web front end as provided from AlchemyTec and a new Java EE backend
that provides a web services API and persistence. 

This project is a Maven project (see pom.xml) and the front end code in it get's compiled using Gulp and Node.js.
The whole project is also a Netbeans project that can be opened in Netbeans (or imported as existing Maven
project in Eclipse or other IDEs).



NOTES:
------

What has changed from the original project and project layout of the front end project?
The front end project structure has been modified slightly: The former src/ folder has been renamed to source/,
the folder static/ renamed to src/main/webapp/static/. And the HTML files and the png file from the root folder 
have been moved to src/main/webapp/. The files in src/main/webapp/ comprise the front end of the deployed app.
Most of the backend is in src/main/java/.



Building and deploying this project requires Java (>= 7), Glassfish (>= 4), a DB like MySQL, Maven, and optionally
an IDE like Netbeans. For making changes to the front end Node.js and Gulp have to be installed too.



Installation
------------

To build this project:

    * create a DB schema (e.g. alchemytectest) in your DB and create a table
      Expense in it (and possibly populate it with some data):
        the file src/main/setup/DB-setup.sql contains the necessary SQL code for
        that and can simply be executed to create schema and table.


    * edit the project so that it points to your database, e.g. a MySql DB:            
        * edit src/main/setup/glassfish-resources.xml
            * this file defines a JDBC connection pool using a MySql DB:
                Change it according to your DB, but leave the JNDI name and
                connection pool names unchanged.

        * have a look at src/main/resources/persistence.xml
                You only have to change this file, if you changed the JNDI name
                of the connection in the glassfish-resources.xml file.

    
    * depending on your application server you also may have to define the JDBC
      connection and connection pool in the admin interface of your application
      server. For Glassfish:
        * access admin interface:
            localhost:4848/
        * use the JDBC Resources and JDBC Connection Pools menus inside the JDBC
          Resources menu as required


    * in case you want to make changes to the front-end: compile the front end
      files using Gulp
        * make the changes in the files inside the source/ folder for anything
          concerning js, angular, less
        * or create or edit the HTML files inside the src/main/webapp/ folder
          (for HTML tasks):

        -> Everything inside the src/main/webapp/ folder is eventually served by
           the webserver.
           The files inside src/main/webapp/static/ are generated by gulp from
           the files in the source/ folder.
           
        * after any change to the font end make sure the src/main/webapp/static/
          folder gets updated with the newest changes. For that simply build the
          project with gulp:
            gulp clean
            gulp dev

            (Now src/main/webapp/static/ should contain your newest changes.)


    * The files inside src/main/webapp/WEB-INF/ define the context root of the
      application. It should be set to '/', the api should be available at
      '/api/*' and the web files at '/'. If your IDE or application server does
      not serve this app on '/', you can edit the project settings and / or edit
      the app's properties inside the app servers admin interface.


    * compile the the whole project and the Java backend using Maven:
      The files that make up the backend can be found inside src/main/java/ and
      src/main/resources/ and src/main/setup/. 

      To build them type the following in a command line inside your project
      folder or use your IDE to perform this:
        * mvn clean install
       
          (deletes old build files and builds and packages the backend with the
           current front end files in it)
      

    * the build files created by Maven can be found in target/, either exploded
      in the folder target/AlchemyCodingTest-1.0-SNAPSHOT/ or in the archive
      target/AlchemyCodingTest-1.0-SNAPSHOT.war.

        -> Deploy this war file as Java EE 7 Web application on an application
           server like Glassfish 4 and it should work.

        -> Depending on your app servers port the AlchemyCodingTest app can be
           accessed like this:
                localhost:8080/default.html
                localhost:8080/api/expenses/
                localhost:8080/api/expenses/1
                localhost:8080/api/expenses/1/4






Potential Issues:
----------------
* After changing the font end (source/..) and recompiling the front end with Gulp
  and the whole project with Maven, the changes to the front end are not always
  propagated into the deployed application! Sometimes you have to run 
  'mvn clean install' or 'gulp dev' 2 times before the changes from the font end
  (source/..) propagate into the actual deployed application!?

    -> Make the gulp clean and gulp dev part of the mvn build?
  
